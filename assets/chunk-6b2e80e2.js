import{c as w}from"./chunk-a456ce36.js";import{a as E,s as a,q as g,f as P,d as u,t as h,A as C,b as S,g as b,c as M,e as x}from"./chunk-f0caae00.js";const n=Object.values(w).find(e=>location.href.match(new RegExp("^"+e.url))),r={};function d(e){let t=null;if(typeof e=="string")e!==""&&(t=document.querySelector(e));else if(e.inShadowDom){const o=e.shadowRootSelector?document.querySelector(e.shadowRootSelector):void 0;t=g(e.selector,o)}else t=document.querySelector(e.selector);return t}function T(){if(n.ignoreStatusCheck)a("contentReady",{id:n.id});else{const e=async()=>{if(d(n.inputSelector)){if(n.readyPreprocessFn)try{await n.readyPreprocessFn()}catch{}a("contentReady",{id:n.id})}else setTimeout(e,200)};e()}}async function F(e){const t=e??"";try{if(n.inputPreprocessFn)try{await n.inputPreprocessFn()}catch{}const o=d(n.inputSelector);if(!o)throw new Error("Cannot find inputElement");if(P(o,t,n.inputMethod),n.sendPreprocessFn)try{await n.sendPreprocessFn()}catch{}if(n.sendMethod==="click"||n.sendMethod==="mousedown"){await u(100);const s=d(n.sendButtonSelector);if(!s)throw new Error("Cannot find sendButtonElement");await h(s,n.sendMethod)}else n.sendMethod==="enter"&&await h(o,n.sendMethod);a("contentReady",{id:n.id})}catch(o){a("contentError",{id:n.id,type:C.SendFailed,extra:o.message}),a("logError",{error:{message:o.message,stack:o.stack},extra:{chatAppId:n.id,contentUrl:location.href,action:"sendText"}})}}async function q(e){const t=n.scrollContainerSelector!==void 0?d(n.scrollContainerSelector):S();if(!t)return e(null),null;r.scrollContainer=t;const o=b(t);if(o.scrollHeight===0||o.scrollWidth===0)return e(null),null;r.containerPosition=o,r.scrollPosition={left:t.scrollLeft,top:t.scrollTop},r.reverseScrollY=window.getComputedStyle(t).getPropertyValue("flex-direction")==="column-reverse",m({left:0,top:0}),await u(500);const s=M(),p=new Map;let l=[];s.forEach(i=>{if(!l.some(c=>c.contains(i))&&(l=l.filter(c=>!i.contains(c)),!i.contains(t)))if(t.contains(i)){const f=window.getComputedStyle(i).getPropertyValue("position");if(f==="absolute"){const y=x(i);t.contains(y)||l.push(i)}else(f==="fixed"||f==="sticky")&&l.push(i)}else l.push(i)}),l.forEach(i=>{const c=i.getAttribute("style")||"";p.set(i,c),i.setAttribute("style",c+";visibility:hidden!important;opacity:0!important;")}),await u(500),r.hiddenElementMap=p,e(o)}function m(e){let t=0;return r.reverseScrollY&&(t=r.containerPosition.scrollHeight-r.containerPosition.clientHeight),r.scrollContainer.scrollTo({left:e.left,top:e.top-t,behavior:"instant"}),{left:r.scrollContainer.scrollLeft,top:r.scrollContainer.scrollTop+t}}function A(){r.scrollContainer.scrollTo({left:r.scrollPosition.left,top:r.scrollPosition.top,behavior:"instant"}),r.hiddenElementMap.forEach((e,t)=>{t.setAttribute("style",e)})}window.name.startsWith("simple-chat-hub")&&(T(),E((e,t,o)=>{if(e==="sendText"&&F(t),e==="newChatPreprocess"&&n.id===t&&n.newChatPreprocessFn)return Promise.resolve(n.newChatPreprocessFn()).catch(s=>{}).finally(()=>{o(null)}),!0;if(e==="getLocationHref"&&n.id===t&&o(window.location.href),e==="captureStart"&&n.id===t)return q(o),!0;if(e==="triggerScroll"&&n.id===t.id){const s=m(t);o(s)}e==="captureEnd"&&A()}));
