var a=Object.defineProperty;var c=(t,e,n)=>e in t?a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var i=(t,e,n)=>(c(t,typeof e!="symbol"?e+"":e,n),n);const l="https://www.google-analytics.com/mp/collect",g="https://www.google-analytics.com/debug/mp/collect",d="G-57PNGJTWHX",E="eS1pKIZhTSqCQLKm4Ng67Q";class m{constructor(e=!1){i(this,"debug");this.debug=e}async getOrCreateClientId(){let{clientId:e}=await chrome.storage.local.get("clientId");return e||(e=self.crypto.randomUUID(),await chrome.storage.local.set({clientId:e})),e}async getOrCreateSessionId(){let{sessionData:e}=await chrome.storage.session.get("sessionData");const n=Date.now();return e&&e.timestamp&&((n-e.timestamp)/6e4>30?e=null:(e.timestamp=n,await chrome.storage.session.set({sessionData:e}))),e||(e={session_id:n.toString(),timestamp:n.toString()},await chrome.storage.session.set({sessionData:e})),e.session_id}async fireEvent(e,n={}){n.session_id||(n.session_id=await this.getOrCreateSessionId()),n.engagement_time_msec||(n.engagement_time_msec=100);try{const o=await fetch(`${this.debug?g:l}?measurement_id=${d}&api_secret=${E}`,{method:"POST",body:JSON.stringify({client_id:await this.getOrCreateClientId(),events:[{name:e,params:n}]})});if(!this.debug)return;console.log(await o.text())}catch(o){console.error("Google Analytics request failed with an exception",o)}}async firePageViewEvent(e,n,o={}){return this.fireEvent("page_view",{page_title:e,page_location:n,...o})}async fireErrorEvent(e,n={}){return this.fireEvent("extension_error",{message:e.message,stack:e.stack,...n})}}const s=new m,r=()=>{const t=new Date;return`${t.getUTCFullYear()}-${t.getUTCMonth()+1}-${t.getUTCDate()}`},f={pageInitialize(){document.readyState==="complete"?s.firePageViewEvent(document.title,document.location.href):window.addEventListener("load",()=>{s.firePageViewEvent(document.title,document.location.href)});let t=r();setInterval(()=>{const e=r();e!==t&&(s.firePageViewEvent(document.title,document.location.href),t=e)},60*1e3),window.addEventListener("unhandledrejection",async e=>{s.fireErrorEvent(e.reason,{source:"page"})})},extensionInitialize(){chrome.runtime.onInstalled.addListener(()=>{s.fireEvent("install")}),addEventListener("unhandledrejection",async t=>{s.fireErrorEvent(t.reason,{source:"service worker"})})},log(t,e){s.fireEvent("log",{message:t,...e})},click(t,e){s.fireEvent("click",{id:t,...e})},keypress(t,e){s.fireEvent("keypress",{id:t,...e})},error(t,e,n){s.fireErrorEvent(t,{source:e,...n})}};async function w(t){return(await chrome.storage.local.get(t))[t]}async function _(t,e){return chrome.storage.local.set({[t]:e})}async function I(t){return(await chrome.storage.session.get(t))[t]}async function h(t,e){return chrome.storage.session.set({[t]:e})}export{h as a,I as b,w as g,f as l,_ as s};
